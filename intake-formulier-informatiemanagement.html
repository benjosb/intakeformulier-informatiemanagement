<!DOCTYPE html>
<html lang="nl" data-theme="light">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Impactanalyse I&amp;D – Intakeformulier Informatiemanagement</title>
<style>
:root {
  --sidebar-meta-width: 72px;
  --sidebar-nav-width: 280px;
  --header-height: 0px; /* Header zit nu in content of sidebar */
  
  --bg-meta: #0b1a29; /* Donkerblauw */
  --bg-nav: #f8f9fa; /* Lichtgrijs */
  --bg-content: #ffffff;
  
  --gradient-start: #005b9f;
  --gradient-end: #00a777;
  
  --text-on-dark: #ffffff;
  --text-muted-on-dark: #8da2b5;
  --hover-on-dark: rgba(255, 255, 255, 0.1);
  
  --border-light: rgba(0,0,0,0.08);
  
  /* Bestaande variabelen behouden voor formulier styling */
  --bg: #ffffff;
  --card: #ffffff;
  --border: rgba(0, 91, 159, 0.18);
  --accent: #0077a5;
  --accent-light: #e0f1ff;
  --text: #102a3c;
  --muted: #587189;
  --support: #009e67;
  --danger: #b42318;
  --radius: 12px;
  --shadow: 0 4px 20px rgba(0,0,0,0.08);
  
  --input-bg: #ffffff;
  --field-empty-bg: #fff6da;
  --field-empty-border: rgba(244, 178, 41, 0.85);
  --field-empty-shadow: rgba(244, 178, 41, 0.25);
  --field-filled-bg: #f0fff7;
  --field-filled-border: rgba(0, 167, 119, 0.65);
  --field-filled-shadow: rgba(0, 167, 119, 0.25);
}

* { box-sizing: border-box; }

body {
  margin: 0;
  padding: 0;
  font-family: "Segoe UI", system-ui, sans-serif;
  color: var(--text);
  background: var(--bg-content);
  height: 100vh;
  overflow: hidden; /* Scrollen gebeurt in de panelen */
  display: flex;
}

/* --- 1. META SIDEBAR (Links, smal, donker) --- */
.layout-meta {
  width: var(--sidebar-meta-width);
  background: var(--bg-meta);
  display: flex;
  flex-direction: column;
  align-items: center;
  padding: 20px 0;
  border-right: 1px solid rgba(255,255,255,0.05);
  z-index: 100;
  flex-shrink: 0;
}

.meta-brand {
  margin-bottom: 30px;
}

.meta-brand img {
  width: 40px;
  height: auto;
  filter: brightness(0) invert(1); /* Logo wit maken indien nodig */
  opacity: 0.9;
}

.meta-nav {
  display: flex;
  flex-direction: column;
  gap: 16px;
  width: 100%;
}

.meta-item {
  width: 48px;
  height: 48px;
  margin: 0 auto;
  border-radius: 10px;
  display: flex;
  align-items: center;
  justify-content: center;
  color: var(--text-muted-on-dark);
  cursor: pointer;
  transition: all 0.2s ease;
  position: relative;
  background: transparent;
  border: none;
}

.meta-item:hover, .meta-item.active {
  background: var(--hover-on-dark);
  color: var(--text-on-dark);
}

.meta-item svg {
  width: 22px;
  height: 22px;
  stroke-width: 1.5;
}

/* Tooltip voor meta items */
.meta-item::after {
  content: attr(data-tooltip);
  position: absolute;
  left: 60px;
  background: #2d3748;
  color: #fff;
  padding: 6px 10px;
  border-radius: 6px;
  font-size: 12px;
  white-space: nowrap;
  opacity: 0;
  pointer-events: none;
  transform: translateX(-10px);
  transition: all 0.2s;
  box-shadow: 0 4px 6px rgba(0,0,0,0.1);
  z-index: 1000;
}

.meta-item:hover::after {
  opacity: 1;
  transform: translateX(0);
}

/* --- 2. NAV SIDEBAR (Midden, lijst met blokken) --- */
.layout-nav {
  width: var(--sidebar-nav-width);
  background: var(--bg-nav);
  border-right: 1px solid var(--border-light);
  display: flex;
  flex-direction: column;
  flex-shrink: 0;
}

.nav-header {
  padding: 24px;
  border-bottom: 1px solid var(--border-light);
}

.nav-header h2 {
  margin: 0;
  font-size: 18px;
  font-weight: 600;
  color: var(--text);
}

.nav-header p {
  margin: 4px 0 0 0;
  font-size: 13px;
  color: var(--muted);
}

.nav-list {
  padding: 20px;
  overflow-y: auto;
  flex: 1;
  display: flex;
  flex-direction: column;
  gap: 8px;
}

.nav-button {
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 12px 16px;
  border-radius: 8px;
  border: none;
  background: transparent;
  color: var(--text);
  font-size: 14px;
  font-weight: 500;
  cursor: pointer;
  text-align: left;
  transition: all 0.2s;
}

.nav-button:hover {
  background: rgba(0,0,0,0.04);
}

.nav-button.active {
  background: #fff;
  color: var(--accent);
  box-shadow: 0 2px 8px rgba(0,0,0,0.05);
  font-weight: 600;
}

.nav-button .status-indicator {
  width: 8px;
  height: 8px;
  border-radius: 50%;
  background: #e2e8f0;
}
.nav-button.active .status-indicator {
  background: var(--accent);
}

/* --- 3. MAIN CONTENT (Rechts, het formulier) --- */
.layout-main {
  flex: 1;
  background: var(--bg-content);
  overflow-y: auto;
  position: relative;
  scroll-behavior: smooth;
}

.content-container {
  max-width: 900px;
  margin: 0 auto;
  padding: 40px;
  padding-bottom: 100px;
}

/* Aanpassingen aan bestaande form styling om in layout te passen */
.app {
  max-width: none;
  margin: 0;
  display: contents; /* App wrapper doet niks meer qua layout */
}

/* Form Sections */
.form-section {
  display: none; /* Standaard verborgen */
  animation: fadeIn 0.3s ease;
}

.form-section.active {
  display: block;
}

@keyframes fadeIn {
  from { opacity: 0; transform: translateY(10px); }
  to { opacity: 1; transform: translateY(0); }
}

header {
  display: none; /* Oude header verbergen we */
}

.form-footer {
  text-align: center;
  margin-top: 60px;
  color: var(--muted);
  font-size: 0.9em;
  padding-bottom: 40px;
}

/* Inputs en layout binnen formulier */
.form-group {
  margin-bottom: 24px;
  background: #fff;
  padding: 0; /* Minder padding want het zit al in container */
}

/* Sticky Action Bar (onderin, optioneel, of in meta) */
/* We zetten de wizard modus en dergelijke in de meta balk */

/* Typography aanpassingen */
h1.page-title {
  font-size: 28px;
  margin-bottom: 10px;
  color: var(--text);
}
.page-subtitle {
  color: var(--muted);
  margin-bottom: 30px;
  display: block;
}

/* Responsive tweaks */
@media (max-width: 1000px) {
  .layout-nav { width: 220px; }
}
  text-transform: uppercase;
  color: var(--muted);
}
header h1 .title-note {
  font-size: 0.42em;
  letter-spacing: 0.05em;
  text-transform: none;
  opacity: 0.45;
  color: var(--muted);
  border-left: 1px solid rgba(0, 0, 0, 0.15);
  padding-left: 10px;
  white-space: nowrap;
}
header p {
  margin: 0;
  color: var(--muted);
}
.header-copy {
  width: 100%;
}
.header-row {
  width: 100%;
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 24px;
}
.header-actions {
  width: 100%;
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 18px;
  margin-top: 12px;
}
.header-logo {
  max-width: 420px;
  width: 100%;
  min-width: 240px;
  filter: drop-shadow(0 28px 46px rgba(2, 42, 73, 0.12));
}
.summary-toggle {
  display: inline-flex;
  align-items: center;
  gap: 8px;
  padding: 12px 22px;
  border-radius: 999px;
  border: 1px solid var(--support);
  background: var(--support);
  color: #fff;
  font-weight: 700;
  letter-spacing: 0.05em;
  text-transform: uppercase;
  box-shadow: 0 12px 28px rgba(0, 158, 103, 0.25);
  cursor: pointer;
  white-space: nowrap;
}
.summary-toggle .icon {
  font-size: 0.9rem;
  opacity: 0.85;
}
.summary-toggle:not(.active) {
  background: #fff;
  color: var(--support);
  box-shadow: none;
}
.meta-toolbar {
  width: 100%;
  display: flex;
  flex-wrap: wrap;
  gap: 10px;
  margin-top: 18px;
  padding: 14px 18px;
  background: #f5fbff;
  border-radius: 999px;
  border: 1px solid rgba(0, 116, 164, 0.15);
  box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.8);
  justify-content: flex-end;
  flex: 1;
}
.meta-toolbar button {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  border: none;
  background: transparent;
  padding: 6px 12px;
  color: var(--muted);
  font-size: 0.85rem;
  font-weight: 500;
  cursor: pointer;
  transition: color 0.15s ease;
  position: relative;
}
.meta-toolbar button:hover {
  color: var(--accent);
  background: rgba(0, 116, 164, 0.04);
  border-radius: 6px;
  transform: none;
  box-shadow: none;
}
.meta-toolbar .icon {
  font-size: 1rem;
  opacity: 0.6;
}
.meta-toolbar button:hover .icon {
  opacity: 1;
}
.header-bar {
  width: 100%;
  display: flex;
  align-items: flex-start;
  justify-content: space-between;
  gap: 16px;
}
.header-copy h1 {
  margin: 0;
  font-size: 32px;
  letter-spacing: 0.04em;
  text-transform: uppercase;
  padding-bottom: 6px;
  display: inline-block;
  border-bottom: 4px solid var(--support);
  text-shadow: 0 10px 30px rgba(0, 0, 0, 0.12);
}
form {
  margin-top: 32px;
  display: flex;
  flex-direction: column;
  gap: 24px;
}
.card {
  background: var(--card);
  border-radius: var(--radius);
  padding: 24px;
  border: 1px solid rgba(0, 0, 0, 0.04);
  box-shadow: var(--shadow);
  border-top: 4px solid var(--support);
}
.card h2 {
  margin-top: 0;
  font-size: 1.25rem;
  color: var(--text);
}
.status-grid {
  margin-top: 16px;
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(210px, 1fr));
  gap: 16px;
}
.status-card {
  border: 1px solid var(--border);
  border-radius: 10px;
  padding: 12px;
  background: var(--card);
  display: flex;
  flex-direction: column;
  gap: 6px;
}
.status-card.wide {
  grid-column: 1 / -1;
}
.tab-nav {
  display: flex;
  flex-wrap: wrap;
  gap: 10px;
}
.tab-button {
  border: 1px solid var(--border);
  background: var(--card);
  color: var(--muted);
  padding: 10px 18px;
  border-radius: 999px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.2s ease;
}
:root[data-theme="dark"] .tab-button {
  background: rgba(255, 255, 255, 0.05);
}
.tab-button.active {
  background: var(--support);
  color: #fff;
  border-color: var(--support);
}
.tab-panel {
  display: none;
}
.tab-panel.active {
  display: block;
}
.field-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
  gap: 16px 20px;
}
.field {
  display: flex;
  flex-direction: column;
  gap: 6px;
}
.field.full {
  grid-column: 1 / -1;
}
.field label,
.field span {
  font-size: 0.9rem;
  font-weight: 600;
  color: var(--muted);
}
.field,
.status-card {
  position: relative;
}
.field::after,
.status-card::after {
  content: "";
  position: absolute;
  top: 8px;
  right: 8px;
  width: 20px;
  height: 20px;
  border-radius: 999px;
  border: 2px solid rgba(16, 42, 60, 0.2);
  background: #fff;
  color: #fff;
  font-size: 0.65rem;
  font-weight: 700;
  display: flex;
  align-items: center;
  justify-content: center;
  opacity: 0;
  transform: scale(0.75);
  transition: all 0.2s ease;
  pointer-events: none;
}
.field[data-state="filled"]::after,
.status-card[data-state="filled"]::after {
  content: "✓";
  opacity: 1;
  transform: scale(1);
  background: var(--support);
  border-color: transparent;
  box-shadow: 0 8px 16px rgba(0, 158, 103, 0.35);
}
.field[data-state="empty"]::after,
.status-card[data-state="empty"]::after {
  opacity: 0.45;
  background: transparent;
  border-style: dashed;
}
.field[data-state="filled"] span,
.status-card[data-state="filled"] > label {
  color: var(--support);
}
.field[data-state="empty"] input:not([type="hidden"]),
.field[data-state="empty"] select,
.field[data-state="empty"] textarea,
.status-card[data-state="empty"] input:not([type="hidden"]),
.status-card[data-state="empty"] select,
.status-card[data-state="empty"] textarea {
  background: var(--field-empty-bg);
  border-color: var(--field-empty-border);
  box-shadow: inset 0 0 0 1px var(--field-empty-shadow);
}
.field[data-state="filled"] input:not([type="hidden"]),
.field[data-state="filled"] select,
.field[data-state="filled"] textarea,
.status-card[data-state="filled"] input:not([type="hidden"]),
.status-card[data-state="filled"] select,
.status-card[data-state="filled"] textarea {
  background: var(--field-filled-bg);
  border-color: var(--field-filled-border);
  box-shadow: 0 0 0 2px var(--field-filled-shadow);
}
.status-card[data-state="empty"] .multi-select-trigger {
  background: var(--field-empty-bg);
  border-color: var(--field-empty-border);
  box-shadow: inset 0 0 0 1px var(--field-empty-shadow);
}
.status-card[data-state="filled"] .multi-select-trigger {
  background: var(--field-filled-bg);
  border-color: var(--field-filled-border);
  box-shadow: 0 0 0 2px var(--field-filled-shadow);
}
input[type="text"],
input[type="date"],
select,
textarea {
  border: 1px solid var(--border);
  border-radius: 10px;
  padding: 10px 12px;
  font-size: 0.95rem;
  font-family: inherit;
  resize: vertical;
  min-height: 44px;
  transition: border 0.2s ease, box-shadow 0.2s ease;
  background: var(--input-bg);
  color: var(--text);
}
textarea {
  min-height: 120px;
}
input:focus,
select:focus,
textarea:focus {
  outline: none;
  border-color: var(--accent);
  box-shadow: 0 0 0 3px var(--accent-light);
}
.fieldset {
  margin-top: 12px;
  padding: 16px;
  border: 1px dashed var(--border);
  border-radius: 10px;
  background: var(--card);
}
.fieldset h3 {
  margin-top: 0;
  font-size: 1rem;
  color: var(--text);
}
.summary-card textarea {
  min-height: 110px;
}
.multi-select {
  position: relative;
}
.multi-select-trigger {
  width: 100%;
  border: 1px solid var(--border);
  border-radius: 10px;
  background: var(--input-bg);
  padding: 10px 12px;
  font-size: 0.95rem;
  text-align: left;
  cursor: pointer;
  color: var(--text);
  display: flex;
  justify-content: space-between;
  align-items: center;
  gap: 12px;
}
.multi-select-value {
  flex: 1;
  color: var(--muted);
}
.multi-select-value.has-value {
  color: var(--text);
}
.multi-select-panel {
  position: absolute;
  top: calc(100% + 6px);
  left: 0;
  right: 0;
  background: var(--card);
  border: 1px solid var(--border);
  border-radius: 12px;
  box-shadow: var(--shadow);
  padding: 10px;
  display: none;
  flex-direction: column;
  gap: 6px;
  z-index: 10;
}
.multi-select-panel label {
  display: flex;
  align-items: center;
  gap: 8px;
  font-size: 0.9rem;
  color: var(--text);
}
.multi-select-panel input {
  width: 16px;
  height: 16px;
}
.multi-select[data-open="true"] .multi-select-panel {
  display: flex;
}
.form-footer {
  margin-top: 24px;
  text-align: right;
  font-size: 0.85rem;
  color: var(--muted);
}
.helper {
  font-size: 0.9rem;
  color: var(--muted);
  margin-top: 8px;
}
.toast {
  position: fixed;
  bottom: 24px;
  right: 24px;
  background: var(--text);
  color: #fff;
  padding: 12px 18px;
  border-radius: 999px;
  opacity: 0;
  pointer-events: none;
  transition: opacity 0.3s ease, transform 0.3s ease;
  transform: translateY(12px);
  z-index: 999;
}
.toast.show {
  opacity: 0.95;
  transform: translateY(0);
}
@media (max-width: 640px) {
  body {
    padding: 16px;
  }
  header {
    padding: 24px;
  }
  .header-cta {
    gap: 8px;
  }
  .tab-button {
    width: 100%;
    justify-content: center;
  }
}
@media print {
  body {
    padding: 0;
    background: #fff;
  }
  .app,
  .wizard-overlay,
  .toast,
  header,
  .action-menu,
  .tab-nav {
    display: none !important;
  }
  #print-export {
    display: block !important;
    padding: 20px;
  }
  #print-export .card {
    box-shadow: none;
    border: 1px solid #eee;
    background: #fff;
    margin-bottom: 16px;
    padding: 16px;
    border-radius: 8px;
    break-inside: avoid;
  }
  #print-export h1 {
    font-size: 18pt;
    margin-bottom: 24px;
    color: #000;
    text-transform: uppercase;
  }
  #print-export h2 {
    font-size: 12pt;
    margin-top: 0;
    margin-bottom: 12px;
    color: #000;
    border-bottom: 2px solid #009e67;
    padding-bottom: 6px;
  }
  #print-export table {
    width: 100%;
    border-collapse: collapse;
    font-size: 9pt;
  }
  #print-export td {
    padding: 4px 8px;
    border-bottom: 1px solid #f0f0f0;
    vertical-align: top;
    line-height: 1.4;
  }
  #print-export td:first-child {
    width: 30%;
    font-weight: 600;
    color: #444;
  }
  #print-export td:last-child {
    color: #000;
  }
  #print-export tr:last-child td {
    border-bottom: none;
  }
}
  .wizard-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(245, 250, 255, 0.98);
    backdrop-filter: blur(8px);
    z-index: 2000;
    display: none;
    flex-direction: column;
    overflow: hidden;
  }
  .wizard-overlay.active {
    display: flex;
  }
  .wizard-header {
    padding: 20px 40px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    background: #fff;
    border-bottom: 1px solid var(--border);
    box-shadow: 0 4px 12px rgba(0,0,0,0.03);
    z-index: 10;
  }
  .wizard-title {
    font-weight: 800;
    font-size: 1.1rem;
    color: var(--text);
    display: flex;
    flex-direction: column;
    line-height: 1.2;
  }
  .wizard-subtitle {
    font-size: 0.75rem;
    color: var(--muted);
    text-transform: uppercase;
    letter-spacing: 0.05em;
    font-weight: 600;
  }
  .wizard-progress-container {
    flex: 1;
    max-width: 400px;
    margin: 0 40px;
    display: flex;
    flex-direction: column;
    gap: 6px;
  }
  .wizard-progress-text {
    font-size: 0.8rem;
    color: var(--muted);
    text-align: center;
    font-variant-numeric: tabular-nums;
  }
  .wizard-progress {
    height: 6px;
    background: rgba(0,0,0,0.06);
    border-radius: 4px;
    overflow: hidden;
  }
  .wizard-bar {
    height: 100%;
    background: linear-gradient(90deg, var(--gradient-start), var(--gradient-end));
    width: 0%;
    transition: width 0.4s cubic-bezier(0.25, 1, 0.5, 1);
  }
  .wizard-stage {
    flex: 1;
    position: relative;
    display: flex;
    align-items: center;
    justify-content: center;
    perspective: 1000px;
    padding: 40px;
  }
  .wizard-card {
    background: var(--card);
    border: 1px solid var(--border);
    border-radius: 16px;
    padding: 40px;
    width: 100%;
    max-width: 680px;
    box-shadow: 0 20px 50px rgba(0,0,0,0.1);
    text-align: left;
    position: absolute;
    transition: all 0.5s cubic-bezier(0.2, 0.8, 0.2, 1);
    opacity: 0;
    pointer-events: none;
    transform: translateX(100px) scale(0.95) rotateY(-5deg);
  }
  .wizard-card.active {
    opacity: 1;
    pointer-events: all;
    transform: translateX(0) scale(1) rotateY(0);
    z-index: 5;
  }
  .wizard-card.prev {
    opacity: 0.4;
    transform: translateX(-120px) scale(0.9) rotateY(5deg) translateZ(-50px);
    filter: blur(2px);
    z-index: 1;
  }
  .wizard-card.next {
    opacity: 0; /* Keep next hidden until active to avoid clutter, or low opacity if desired */
    transform: translateX(120px) scale(0.9) rotateY(-5deg) translateZ(-50px);
  }
  .wizard-card h3 {
    margin-top: 0;
    font-size: 1.4rem;
    color: var(--text);
    margin-bottom: 12px;
    border-bottom: 2px solid var(--support);
    padding-bottom: 12px;
    display: inline-block;
  }
  .wizard-helper {
    font-size: 0.95rem;
    color: var(--muted);
    background: #f8fbff;
    border-left: 3px solid var(--accent);
    padding: 12px 16px;
    margin-bottom: 24px;
    border-radius: 0 8px 8px 0;
    line-height: 1.5;
  }
  .wizard-card .field-container {
    margin-bottom: 32px;
  }
  .wizard-card .field-container label {
    display: none; /* Hide original label as we show h3 */
  }
  .wizard-nav {
    display: flex;
    justify-content: space-between;
    gap: 16px;
    margin-top: auto;
    padding-top: 20px;
    border-top: 1px solid rgba(0,0,0,0.05);
  }
  .wizard-btn {
    padding: 12px 28px;
    border-radius: 999px;
    border: none;
    font-size: 1rem;
    cursor: pointer;
    font-weight: 700;
    transition: transform 0.2s ease, box-shadow 0.2s ease;
    display: flex;
    align-items: center;
    gap: 8px;
  }
  .wizard-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(0,0,0,0.1);
  }
  .wizard-btn.prev {
    background: #fff;
    border: 1px solid var(--border);
    color: var(--muted);
  }
  .wizard-btn.next {
    background: var(--gradient-end);
    color: #fff;
    box-shadow: 0 4px 12px rgba(0, 167, 119, 0.3);
  }
  .wizard-close {
    background: transparent;
    border: 1px solid var(--border);
    width: 36px;
    height: 36px;
    border-radius: 50%;
    font-size: 1.2rem;
    cursor: pointer;
    color: var(--muted);
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.2s ease;
  }
  .wizard-close:hover {
    background: #fff;
    color: var(--danger);
    border-color: var(--danger);
  }
</style>
</head>
<body>

<!-- Verborgen inputs voor functionaliteit -->
<input type="file" id="file-input" accept=".json" style="display: none;" onchange="importData(this)">
<input type="file" id="pdf-input" accept=".pdf" style="display: none;" onchange="handlePdfUpload(this)">

<!-- 1. META SIDEBAR (Links) -->
<aside class="layout-meta">
  <div class="meta-brand" title="Wassenaar">
     <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path><polyline points="9 22 9 12 15 12 15 22"></polyline></svg>
  </div>
  
  <nav class="meta-nav">
     <button class="meta-item active" data-tooltip="Dashboard" onclick="showSection('samenvatting')">
       <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="7" height="7"></rect><rect x="14" y="3" width="7" height="7"></rect><rect x="14" y="14" width="7" height="7"></rect><rect x="3" y="14" width="7" height="7"></rect></svg>
     </button>
     
     <div style="height: 1px; background: rgba(255,255,255,0.1); width: 60%; margin: 8px auto;"></div>

     <button class="meta-item" data-tooltip="Nieuw Formulier" onclick="if(confirm('Weet je zeker dat je opnieuw wilt beginnen?')) resetForm()">
       <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="12" y1="18" x2="12" y2="12"></line><line x1="9" y1="15" x2="15" y2="15"></line></svg>
     </button>
     
     <button class="meta-item" data-tooltip="Laden (JSON)" onclick="document.getElementById('file-input').click()">
       <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="7 10 12 15 17 10"></polyline><line x1="12" y1="15" x2="12" y2="3"></line></svg>
     </button>

     <button class="meta-item" data-tooltip="PDF Vullen" onclick="fillFromPdf()">
       <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="12" y1="18" x2="12" y2="12"></line><line x1="9" y1="15" x2="15" y2="15"></line></svg>
     </button>
     
     <button class="meta-item" data-tooltip="Opslaan (JSON)" onclick="exportData()">
       <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path><polyline points="17 21 17 13 7 13 7 21"></polyline><polyline points="7 3 7 8 15 8"></polyline></svg>
     </button>
     
     <button class="meta-item" data-tooltip="Export PDF" onclick="generatePDF()">
       <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line><polyline points="10 9 9 9 8 9"></polyline></svg>
     </button>

     <button class="meta-item" data-tooltip="Export Word" onclick="generateWord()">
       <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="8" y1="13" x2="16" y2="13"></line><line x1="8" y1="17" x2="16" y2="17"></line><line x1="10" y1="9" x2="8" y2="9"></line></svg>
     </button>
     
     <div style="flex: 1"></div>
     
     <button class="meta-item" data-tooltip="Wizard Modus" onclick="startWizard()">
       <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"></path></svg>
     </button>
  </nav>
</aside>

<!-- 2. NAV SIDEBAR (Midden) -->
<aside class="layout-nav">
  <div class="nav-header">
    <h2>Intake I&D</h2>
    <p>Impactanalyse</p>
  </div>
  <nav class="nav-list" id="main-nav">
    <button class="nav-button active" onclick="switchTab('samenvatting', this)">
      <span class="status-indicator"></span> Samenvatting
    </button>
    <button class="nav-button" onclick="switchTab('blok1', this)">
      <span class="status-indicator"></span> 1. Basisinfo
    </button>
    <button class="nav-button" onclick="switchTab('blok2', this)">
      <span class="status-indicator"></span> 2. Infobehoefte
    </button>
    <button class="nav-button" onclick="switchTab('blok3', this)">
      <span class="status-indicator"></span> 3. Applicatie
    </button>
    <button class="nav-button" onclick="switchTab('blok4', this)">
      <span class="status-indicator"></span> 4. Veiligheid & Privacy
    </button>
    <button class="nav-button" onclick="switchTab('blok5', this)">
      <span class="status-indicator"></span> 5. Architectuur
    </button>
  </nav>
</aside>

<!-- 3. MAIN CONTENT (Rechts) -->
<main class="layout-main">
  
  <!-- Wizard Overlay (behoud functionaliteit) -->
  <div class="wizard-overlay" id="wizard-overlay">
    <div class="wizard-header">
      <div class="wizard-title">
        <span>Wizard Modus</span>
        <span class="wizard-subtitle" id="wizard-section-title">Start</span>
      </div>
      <div class="wizard-progress-container">
        <div class="wizard-progress"><div class="wizard-bar" id="wizard-bar"></div></div>
        <div class="wizard-progress-text" id="wizard-progress-text">0 / 0</div>
      </div>
      <button class="wizard-close" id="wizard-close" title="Sluiten">✕</button>
    </div>
    <div class="wizard-stage" id="wizard-stage"></div>
  </div>

  <div class="content-container">
     <header style="display:block; background:none; box-shadow:none; border:none; padding:0; margin-bottom: 30px;">
        <h1 class="page-title">Intakeformulier Informatiemanagement</h1>
        <span class="page-subtitle">Impactanalyse I&D • Gemeente Wassenaar</span>
     </header>

     <form id="intake-form" autocomplete="off">


    <section class="card tab-panel active summary-card" id="view-samenvatting" data-section="Samenvatting">
      <h2>Samenvatting van de adviezen &amp; bevindingen</h2>
      <p class="helper">Begin hier met de belangrijkste risico’s, keuzes en besluitpunten. De status-kaarten helpen om direct te zien welk team aan zet is.</p>
      <div class="status-grid">
        <div class="status-card wide">
          <label for="field-summary">Samenvatting</label>
          <textarea id="field-summary" data-field="summary" data-label="Samenvatting" rows="4" placeholder="Korte duiding van de belangrijkste bevindingen en adviezen."></textarea>
        </div>
        <div class="status-card">
          <label for="field-status">Status</label>
          <select id="field-status" data-field="status" data-label="Status">
            <option value="">Kies status</option>
            <option>Niet gestart</option>
            <option>Inventarisatie</option>
            <option>Analyse loopt</option>
            <option>Afstemming nodig</option>
            <option>Gereed voor besluit</option>
            <option>Afgerond</option>
            <option>Niet van toepassing</option>
          </select>
        </div>
        <div class="status-card">
          <label for="field-im">Informatiemanagement</label>
          <select id="field-im" data-field="informatiemanagement" data-label="Informatiemanagement">
            <option value="">Kies status</option>
            <option>Niet gestart</option>
            <option>Onderzoek loopt</option>
            <option>Extra aandacht</option>
            <option>Goedgekeurd</option>
            <option>Niet van toepassing</option>
          </select>
        </div>
        <div class="status-card">
          <label for="field-privacy">Privacy</label>
          <select id="field-privacy" data-field="privacy" data-label="Privacy">
            <option value="">Kies status</option>
            <option>Niet gestart</option>
            <option>DPIA vereist</option>
            <option>In behandeling</option>
            <option>Goedgekeurd</option>
            <option>Niet van toepassing</option>
          </select>
        </div>
        <div class="status-card">
          <label for="field-security">Informatieveiligheid</label>
          <select id="field-security" data-field="informatieveiligheid" data-label="Informatieveiligheid">
            <option value="">Kies status</option>
            <option>Niet gestart</option>
            <option>Analyse loopt</option>
            <option>Risico's aanwezig</option>
            <option>Oké</option>
            <option>Niet van toepassing</option>
          </select>
        </div>
        <div class="status-card">
          <label for="field-fb">Functioneel beheer</label>
          <select id="field-fb" data-field="functioneel-beheer" data-label="Functioneel beheer">
            <option value="">Kies status</option>
            <option>Niet gestart</option>
            <option>Capaciteit nodig</option>
            <option>Ingericht</option>
            <option>Niet van toepassing</option>
          </select>
        </div>
        <div class="status-card">
          <label for="field-tb">Technisch beheer</label>
          <select id="field-tb" data-field="technisch-beheer" data-label="Technisch beheer">
            <option value="">Kies status</option>
            <option>Niet gestart</option>
            <option>Afhankelijkheden</option>
            <option>Ingericht</option>
            <option>Uitbesteed</option>
            <option>Niet van toepassing</option>
          </select>
        </div>
        <div class="status-card">
          <label for="field-arch">Architectuur</label>
          <select id="field-arch" data-field="architectuur" data-label="Architectuur">
            <option value="">Kies status</option>
            <option>Niet getoetst</option>
            <option>Onderzoek loopt</option>
            <option>Afwijking</option>
            <option>Conform richtlijnen</option>
            <option>Niet van toepassing</option>
          </select>
        </div>
        <div class="status-card">
          <label for="field-archivering">Archivering</label>
          <select id="field-archivering" data-field="archivering" data-label="Archivering">
            <option value="">Kies status</option>
            <option>Niet gestart</option>
            <option>Afspraken nodig</option>
            <option>Geborgd</option>
            <option>Niet van toepassing</option>
          </select>
        </div>
        <div class="status-card">
          <label for="field-inkoop">Inkoop</label>
          <select id="field-inkoop" data-field="inkoop" data-label="Inkoop">
            <option value="">Kies status</option>
            <option>Niet gestart</option>
            <option>Marktverkenning</option>
            <option>Onderhandeling</option>
            <option>Gereed</option>
            <option>Niet van toepassing</option>
          </select>
        </div>
      </div>
    </section>

    <section class="card tab-panel" id="blok-1" data-section="BLOK 1. Basisinformatie">
      <div class="field-grid">
        <label class="field">
          <span>Verantwoordelijk proceseigenaar</span>
          <input type="text" data-field="proceseigenaar" data-label="Verantwoordelijk proceseigenaar">
        </label>
        <label class="field">
          <span>Naam medewerker (verzoeker)</span>
          <input type="text" data-field="verzoeker" data-label="Naam medewerker (verzoeker)">
        </label>
        <label class="field">
          <span>Naam van het proces</span>
          <input type="text" data-field="procesnaam" data-label="Naam van het proces">
        </label>
        <label class="field">
          <span>Staat op het A3 Jaarplan</span>
          <select data-field="a3-status" data-label="Staat op het A3 Jaarplan">
            <option value="">Selecteer</option>
            <option>Ja</option>
            <option>Nee</option>
            <option>Gedeeltelijk / indirect</option>
          </select>
        </label>
        <label class="field full">
          <span>Draagt bij aan (max. 3)</span>
          <div style="display: flex; gap: 12px;">
            <select data-field="contribution-1" data-label="Draagt bij aan (1)" style="flex: 1;">
              <option value="">Kies waardeketen 1</option>
              <option>Efficiënte bedrijfsvoering</option>
              <option>Goede dienstverlening</option>
              <option>Datagedreven werken</option>
              <option>Transparantie</option>
              <option>Onder architectuur</option>
            </select>
            <select data-field="contribution-2" data-label="Draagt bij aan (2)" style="flex: 1;">
              <option value="">Kies waardeketen 2</option>
              <option>Efficiënte bedrijfsvoering</option>
              <option>Goede dienstverlening</option>
              <option>Datagedreven werken</option>
              <option>Transparantie</option>
              <option>Onder architectuur</option>
            </select>
            <select data-field="contribution-3" data-label="Draagt bij aan (3)" style="flex: 1;">
              <option value="">Kies waardeketen 3</option>
              <option>Efficiënte bedrijfsvoering</option>
              <option>Goede dienstverlening</option>
              <option>Datagedreven werken</option>
              <option>Transparantie</option>
              <option>Onder architectuur</option>
            </select>
          </div>
        </label>
        <label class="field full">
          <span>Afstemming met proceseigenaar</span>
          <textarea data-field="afstemming" data-label="Afstemming met proceseigenaar" rows="3"></textarea>
        </label>
        <label class="field">
          <span>Datum intake</span>
          <input type="date" data-field="datum-intake" data-label="Datum intake">
        </label>
        <label class="field">
          <span>Gewenste datum inwerkingtreding</span>
          <input type="date" data-field="gew-datum" data-label="Gewenste datum inwerkingtreding">
        </label>
        <label class="field full">
          <span>Wettelijke grondslag</span>
          <textarea data-field="wettelijke-grondslag" data-label="Wettelijke grondslag" rows="3"></textarea>
        </label>
        <label class="field">
          <span>TOPdesk melding</span>
          <input type="text" data-field="topdesk" data-label="TOPdesk melding" placeholder="Bijv. nummer of link">
        </label>
        <label class="field full">
          <span>Financiële dekking</span>
          <textarea data-field="financiele-dekking" data-label="Financiële dekking" rows="3"></textarea>
        </label>
        <label class="field">
          <span>Behoefte bij beide gemeenten?</span>
          <select data-field="behoefte-gemeenten" data-label="Behoefte bij beide gemeenten">
            <option value="">Selecteer</option>
            <option>Ja, beide gemeenten</option>
            <option>Alleen Voorschoten</option>
            <option>Alleen Wassenaar</option>
            <option>Nader te bepalen</option>
          </select>
        </label>
      </div>
      <div class="fieldset">
        <h3>Capaciteit (indicatie)</h3>
        <div class="field-grid">
          <label class="field">
            <span>Afdeling Informatie &amp; Datamanagement (I&amp;D)</span>
            <textarea data-field="capaciteit-idm" data-label="Capaciteit I&amp;D" rows="3" placeholder="Bijv. uren, rollen of specifieke expertise."></textarea>
          </label>
          <label class="field">
            <span>Initiatiefnemer / afdeling</span>
            <textarea data-field="capaciteit-initiatief" data-label="Capaciteit initiatiefnemer" rows="3"></textarea>
          </label>
          <label class="field">
            <span>Leveranciers</span>
            <textarea data-field="capaciteit-leveranciers" data-label="Capaciteit leveranciers" rows="3"></textarea>
          </label>
          <label class="field">
            <span>Overige capaciteit / opmerkingen</span>
            <textarea data-field="capaciteit-overig" data-label="Capaciteit overig" rows="3"></textarea>
          </label>
        </div>
      </div>
    </section>

    <section class="card tab-panel" id="blok-2" data-section="BLOK 2. Informatiebehoefte">
      <div class="field-grid">
        <label class="field full">
          <span>Behoefte en aanleiding</span>
          <textarea data-field="behoefte-aanleiding" data-label="Behoefte en aanleiding" rows="4"></textarea>
        </label>
        <label class="field">
          <span>Opgenomen in het A3 jaarplan?</span>
          <select data-field="a3-opgenomen" data-label="Opgenomen in A3 jaarplan">
            <option value="">Selecteer</option>
            <option>Ja</option>
            <option>Nee</option>
            <option>Indirect / via ander initiatief</option>
          </select>
        </label>
        <label class="field full">
          <span>Huidige situatie</span>
          <textarea data-field="huidige-situatie" data-label="Huidige situatie" rows="4"></textarea>
        </label>
        <label class="field full">
          <span>Risico’s als huidige situatie blijft bestaan</span>
          <textarea data-field="risicos" data-label="Risico’s huidige situatie" rows="4"></textarea>
        </label>
        <label class="field full">
          <span>Gewenste situatie</span>
          <textarea data-field="gewenste-situatie" data-label="Gewenste situatie" rows="4"></textarea>
        </label>
        <label class="field full">
          <span>Wat levert het op?</span>
          <textarea data-field="opbrengsten" data-label="Wat levert het op" rows="4"></textarea>
        </label>
        <label class="field full">
          <span>Oorspronkelijke uitvraag</span>
          <textarea data-field="oorspronkelijke-uitvraag" data-label="Oorspronkelijke uitvraag" rows="4"></textarea>
        </label>
        <label class="field">
          <span>Type aanvraag</span>
          <select data-field="type-aanvraag" data-label="Type aanvraag">
            <option value="">Selecteer</option>
            <option>Nieuwe oplossing</option>
            <option>Vervanging bestaande oplossing</option>
            <option>Uitbreiding / wijziging</option>
            <option>Contractverlenging</option>
            <option>Pilot / proef</option>
          </select>
        </label>
        <label class="field full">
          <span>Toelichting type aanvraag</span>
          <textarea data-field="toelichting-type" data-label="Toelichting type aanvraag" rows="3"></textarea>
        </label>
      </div>
    </section>

    <section class="card tab-panel" id="blok-3" data-section="BLOK 3. Applicatie &amp; marktverkenning">
      <div class="field-grid">
        <label class="field full">
          <span>Bestaande interne oplossing?</span>
          <textarea data-field="interne-oplossing" data-label="Bestaande interne oplossing" rows="3"></textarea>
        </label>
        <label class="field full">
          <span>Verkenning SW-broker Protinus</span>
          <textarea data-field="sw-broker" data-label="Verkenning SW-broker Protinus" rows="3"></textarea>
        </label>
        <label class="field">
          <span>Bekend met SW-broker?</span>
          <select data-field="sw-broker-bekend" data-label="Bekend met SW-broker">
            <option value="">Selecteer</option>
            <option>Ja</option>
            <option>Nee</option>
            <option>In verkenning</option>
          </select>
        </label>
        <label class="field full">
          <span>VNG Softwarecatalogus</span>
          <textarea data-field="vng-catalogus" data-label="VNG Softwarecatalogus" rows="3"></textarea>
        </label>
        <label class="field">
          <span>Grootste concurrent</span>
          <input type="text" data-field="concurrent" data-label="Grootste concurrent">
        </label>
        <label class="field">
          <span>SLA of DVO aanwezig?</span>
          <select data-field="sla-dvo" data-label="SLA of DVO">
            <option value="">Selecteer</option>
            <option>Ja, actueel</option>
            <option>Ja, verouderd</option>
            <option>Nee</option>
            <option>Nog te bepalen</option>
          </select>
        </label>
        <label class="field full">
          <span>Koppeling met DigiD, eHerkenning of eIDAS</span>
          <textarea data-field="koppeling-id" data-label="Koppeling met DigiD/eHerkenning/eIDAS" rows="3"></textarea>
        </label>
        <label class="field">
          <span>Behoefte aan functioneel beheer?</span>
          <select data-field="fb-behoefte" data-label="Behoefte functioneel beheer">
            <option value="">Selecteer</option>
            <option>Ja, intern</option>
            <option>Ja, extern</option>
            <option>Deels (co-sourcing)</option>
            <option>Nee</option>
          </select>
        </label>
        <label class="field full">
          <span>Taken en verantwoordelijkheden functioneel beheer</span>
          <textarea data-field="fb-taken" data-label="Taken functioneel beheer" rows="3"></textarea>
        </label>
        <label class="field">
          <span>Type functioneel beheer</span>
          <select data-field="fb-type" data-label="Type functioneel beheer">
            <option value="">Selecteer</option>
            <option>Lokaal</option>
            <option>Centraal</option>
            <option>Hybride</option>
            <option>Extern</option>
          </select>
        </label>
        <label class="field full">
          <span>Verwachtte capaciteit vanuit IT-basisdiensten</span>
          <textarea data-field="itb-capaciteit" data-label="Verwachtte capaciteit IT-basisdiensten" rows="3"></textarea>
        </label>
      </div>
    </section>

    <section class="card tab-panel" id="blok-4" data-section="BLOK 4. Informatiebeveiliging &amp; privacy">
      <div class="field-grid">
        <label class="field full">
          <span>Toetsing aan BIO2-eisen</span>
          <textarea data-field="bio2" data-label="Toetsing aan BIO2-eisen" rows="3"></textarea>
        </label>
        <label class="field full">
          <span>Toetsing aan NIS2-eisen</span>
          <textarea data-field="nis2" data-label="Toetsing aan NIS2-eisen" rows="3"></textarea>
        </label>
        <label class="field full">
          <span>Dataclassificatie (risicobeoordeling BIO2)</span>
          <textarea data-field="dataclassificatie" data-label="Dataclassificatie" rows="3"></textarea>
        </label>
        <label class="field">
          <span>Voldoet aan BIO2 en NIS2 (artikel 21 Cbw)?</span>
          <select data-field="bio2-conform" data-label="Voldoet aan BIO2/NIS2">
            <option value="">Selecteer</option>
            <option>Ja</option>
            <option>Nee</option>
            <option>Deels</option>
            <option>N.t.b.</option>
          </select>
        </label>
        <label class="field">
          <span>Voldoet aan ISO 27001?</span>
          <select data-field="iso27001" data-label="Voldoet aan ISO 27001">
            <option value="">Selecteer</option>
            <option>Ja</option>
            <option>Nee</option>
            <option>Onder voorwaarden</option>
            <option>N.t.b.</option>
          </select>
        </label>
        <label class="field">
          <span>Logging ingericht conform BIO2?</span>
          <select data-field="logging" data-label="Logging conform BIO2">
            <option value="">Selecteer</option>
            <option>Ja</option>
            <option>Nee</option>
            <option>In ontwikkeling</option>
            <option>N.v.t.</option>
          </select>
        </label>
        <label class="field">
          <span>Back-up &amp; herstel voorziening aanwezig?</span>
          <select data-field="backup" data-label="Back-up &amp; herstel">
            <option value="">Selecteer</option>
            <option>Ja</option>
            <option>Nee</option>
            <option>Onder voorwaarden</option>
            <option>N.v.t.</option>
          </select>
        </label>
        <label class="field">
          <span>Verwerken van persoonsgegevens?</span>
          <select data-field="persoonsgegevens" data-label="Verwerken van persoonsgegevens">
            <option value="">Selecteer</option>
            <option>Geen persoonsgegevens</option>
            <option>Gewone persoonsgegevens</option>
            <option>Gevoelige/bijzondere gegevens</option>
            <option>Nader onderzoek nodig</option>
          </select>
        </label>
        <label class="field full">
          <span>Welke persoonsgegevens?</span>
          <textarea data-field="persoonsgegevens-detail" data-label="Welke persoonsgegevens" rows="3"></textarea>
        </label>
        <label class="field full">
          <span>Categorieën betrokkenen</span>
          <textarea data-field="categorieen-betrokkenen" data-label="Categorieën betrokkenen" rows="3"></textarea>
        </label>
        <label class="field full">
          <span>AVG-grondslag van de verwerking</span>
          <textarea data-field="avg-grondslag" data-label="AVG-grondslag" rows="3"></textarea>
        </label>
        <label class="field full">
          <span>Doeleinden van verwerking</span>
          <textarea data-field="doeleinden" data-label="Doeleinden van verwerking" rows="3"></textarea>
        </label>
        <label class="field full">
          <span>Verwerkersovereenkomst afgesloten?</span>
          <textarea data-field="verwerkersovereenkomst" data-label="Verwerkersovereenkomst" rows="3"></textarea>
        </label>
        <label class="field full">
          <span>Doorgifte buiten EU/EER</span>
          <textarea data-field="doorgifte" data-label="Doorgifte buiten EU/EER" rows="3"></textarea>
        </label>
        <label class="field full">
          <span>Gebruik van AI of algoritmen</span>
          <textarea data-field="ai-algoritmen" data-label="Gebruik van AI of algoritmen" rows="3"></textarea>
        </label>
        <label class="field full">
          <span>DPIA (Data Protection Impact Assessment)</span>
          <textarea data-field="dpia" data-label="DPIA" rows="3" placeholder="Is een DPIA uitgevoerd of noodzakelijk?"></textarea>
        </label>
      </div>
    </section>

    <section class="card tab-panel" id="blok-5" data-section="BLOK 5. Architectuur &amp; standaardisatie">
      <div class="field-grid">
        <label class="field full">
          <span>Aansluiting zaaksysteem</span>
          <textarea data-field="zaaksysteem" data-label="Aansluiting zaaksysteem" rows="3"></textarea>
        </label>
        <label class="field full">
          <span>Document-management</span>
          <textarea data-field="document-management" data-label="Document-management" rows="3"></textarea>
        </label>
        <label class="field full">
          <span>Gebruik van basisregistraties</span>
          <textarea data-field="basisregistraties" data-label="Gebruik van basisregistraties" rows="3"></textarea>
        </label>
        <label class="field full">
          <span>Koppelingen met interne/externe systemen</span>
          <textarea data-field="koppelingen" data-label="Koppelingen met interne/externe systemen" rows="3"></textarea>
        </label>
        <label class="field full">
          <span>Gegevensuitwisseling met andere systemen</span>
          <textarea data-field="gegevensuitwisseling" data-label="Gegevensuitwisseling" rows="3"></textarea>
        </label>
        <label class="field full">
          <span>Koppelingen met basisregistraties</span>
          <textarea data-field="koppelingen-basis" data-label="Koppelingen met basisregistraties" rows="3"></textarea>
        </label>
        <label class="field full">
          <span>Past binnen de gemeentelijke waardeketen</span>
          <textarea data-field="waardeketen" data-label="Past binnen de waardeketen" rows="3"></textarea>
        </label>
        <label class="field">
          <span>Common Ground oplossing beschikbaar?</span>
          <select data-field="common-ground" data-label="Common Ground">
            <option value="">Selecteer</option>
            <option>Ja</option>
            <option>Nee</option>
            <option>Onderzoek loopt</option>
          </select>
        </label>
        <label class="field full">
          <span>Gebruik van API’s</span>
          <textarea data-field="apis" data-label="Gebruik van API’s" rows="3"></textarea>
        </label>
        <label class="field">
          <span>Bewaartermijn (Selectielijst Gemeenten)</span>
          <select data-field="bewaartermijn" data-label="Bewaartermijn">
            <option value="">Selecteer</option>
            <option>1 jaar</option>
            <option>5 jaar</option>
            <option>7 jaar</option>
            <option>10 jaar</option>
            <option>Permanent</option>
            <option>Nee, zie toelichting</option>
          </select>
        </label>
        <label class="field full">
          <span>Documentopslag locatie</span>
          <textarea data-field="documentopslag" data-label="Documentopslag locatie" rows="3"></textarea>
        </label>
        <label class="field full">
          <span>Vernietigingsprocedure</span>
          <textarea data-field="vernietiging" data-label="Vernietigingsprocedure" rows="3"></textarea>
        </label>
        <label class="field full">
          <span>Metadata (MDTO / Forum Standaardisatie)</span>
          <textarea data-field="metadata" data-label="Metadata" rows="3"></textarea>
        </label>
      </div>
    </section>

  </form>
  <footer class="form-footer">Versie 2025.12.16 (3) - Redesign</footer>
  </div>
</main>

<input type="file" id="json-import" accept="application/json" hidden>
<div class="toast" id="toast" role="status" aria-live="polite"></div>
<div id="print-export" style="display:none;"></div>

<script>
/* Nieuwe navigatie logica voor layout v2 */
window.switchTab = function(targetRef, btnElement) {
  // 1. Knoppen updaten
  if (btnElement) {
    document.querySelectorAll('.nav-button').forEach(b => b.classList.remove('active'));
    btnElement.classList.add('active');
  }

  // 2. Mapping naar oude ID's
  let realId = targetRef;
  if (targetRef === 'samenvatting') realId = 'view-samenvatting';
  else if (targetRef.startsWith('blok') && !targetRef.includes('-')) {
    // blok1 -> blok-1
    realId = targetRef.replace('blok', 'blok-');
  }

  // 3. Secties tonen/verbergen
  document.querySelectorAll('.tab-panel').forEach(panel => {
    panel.style.display = 'none';
    panel.classList.remove('active');
  });

  const target = document.getElementById(realId);
  if (target) {
    target.style.display = 'block';
    target.classList.add('active');
    // Scroll naar boven
    const container = document.querySelector('.layout-main');
    if(container) container.scrollTo({ top: 0, behavior: 'smooth' });
  } else {
    console.warn("Sectie niet gevonden:", realId);
  }
};

window.showSection = function(ref) {
  // Zoek de bijbehorende knop in de zijbalk
  // ref kan zijn 'samenvatting' of 'blok-1'
  let btnSelector = '';
  if(ref === 'samenvatting') btnSelector = "switchTab('samenvatting'";
  else {
    const shortRef = ref.replace('-', ''); // blok-1 -> blok1
    btnSelector = `switchTab('${shortRef}'`;
  }
  
  // Vind de button die deze functie aanroept
  const buttons = Array.from(document.querySelectorAll('.nav-button'));
  const targetBtn = buttons.find(b => b.getAttribute('onclick').includes(btnSelector));
  
  if(targetBtn) {
    targetBtn.click();
  } else {
    // Fallback als knop niet gevonden
    switchTab(ref, null);
  }
};

// Zorg dat bij laden de eerste tab actief is
document.addEventListener('DOMContentLoaded', () => {
  showSection('samenvatting');
});
</script>
<script>
(function () {
  const pdfPrefill = {
    summary:
      "Offerte voor MOOR Facturatie-Ondersteuning (implementatie, licentie en beheer) d.d. 26 augustus 2025. Doel: naadloze export van straatwerk- en legesstromen vanuit het MOOR Platform naar het gemeentelijke facturatiesysteem.",
    status: "Afstemming nodig",
    informatiemanagement: "Onderzoek loopt",
    privacy: "Niet van toepassing",
    "informatieveiligheid": "Niet gestart",
    "functioneel-beheer": "Capaciteit nodig",
    "technisch-beheer": "Afhankelijkheden",
    architectuur: "Onderzoek loopt",
    archivering: "Niet van toepassing",
    inkoop: "Onderhandeling",
    contribution:
      "Biedt een gecontroleerde en herhaalbare aansluiting tussen graafmeldingen/legeskosten en het financiële systeem, vermindert handwerk en versnelt facturatie voor de dienst MOOR Platform.",
    "contribution-1": "Efficiënte bedrijfsvoering",
    "contribution-2": "Goede dienstverlening",
    "contribution-3": "",
    proceseigenaar: "Ruud de Gans (Gemeente Wassenaar)",
    verzoeker: "Naam Aanvrager",
    procesnaam: "Naam Proces (bijv. Zaaksysteem)",
    "a3-status": "Gedeeltelijk / indirect",
    afstemming:
      "Offerte opgesteld op 26 augustus 2025 na e-mailcontact tussen Luuk Spijkers en Ruud de Gans / Marjan van der Neut.",
    "datum-intake": "2025-08-26",
    "wettelijke-grondslag":
      "Geen specifieke wettelijke verplichting; verbetering van aansluiting financiële stromen graafmeldingen en leges op basis van gemeentelijke afspraken.",
    "financiele-dekking":
      "Implementatiekosten € 2.625 eenmalig, jaarlijkse licentie- en beheerfee € 1.795 (prijspeil 2025) exclusief btw.",
    "behoefte-gemeenten": "Alleen Wassenaar",
    "capaciteit-idm":
      "Informatie & Datamanagement levert projectbegeleiding voor implementatie, inrichting van export en kwaliteitsbewaking.",
    "capaciteit-initiatief":
      "Stakeholders Ruud de Gans / Marjan van der Neut (Wassenaar) leveren proceskennis en bepalen gewenste verwerking.",
    "capaciteit-leveranciers":
      "Roxit / MOOR verzorgt implementatie (kick-off, inventarisatie, test- en productiefase) en jaarlijkse ondersteuning.",
    "capaciteit-overig":
      "Afdeling Financiën levert requirements voor importformaat en test de koppeling; optioneel leverancier facturatiesysteem betrokken.",
    "behoefte-aanleiding":
      "Gemeente Wassenaar wil de aansluiting van MOOR-registraties (straatwerkkosten en legeskosten) op het facturatiesysteem verbeteren.",
    "a3-opgenomen": "Indirect / via ander initiatief",
    "huidige-situatie":
      "Er is al een MOOR Platform voor graafmeldingen, maar de financiële stromen worden nog handmatig opgepakt waardoor dubbele invoer nodig is.",
    risicos:
      "Handmatige verwerking van exportbestanden is foutgevoelig, vertraagt facturatie en levert beperkte controle over debiteurgegevens.",
    "gewenste-situatie":
      "Een standaard MOOR F-O export die periodiek factuurregels oplevert in het gewenste formaat zodat Financiën direct kan inlezen.",
    opbrengsten:
      "Snellere facturatie, minder handwerk, eenduidige aansluiting tussen MOOR en het financiële systeem, beter overzicht per debiteur.",
    "oorspronkelijke-uitvraag":
      "Vraag aan MOOR om implementatie, licentieafname en beheer voor facturatie-ondersteuning inclusief export naar financieel systeem.",
    "type-aanvraag": "Uitbreiding / wijziging",
    "toelichting-type":
      "Uitbreiding op bestaande MOOR Platform-voorziening waarbij nieuwe functionaliteit voor facturatie wordt toegevoegd.",
    "interne-oplossing":
      "Bestaande combinatie van MOOR Platform en gemeentelijk facturatiesysteem; koppeling ontbreekt of gebeurt handmatig.",
    "sw-broker":
      "Niet via SW-broker aangevraagd; directe offerte van MOOR/Roxit gericht op deze aansluiting.",
    "vng-catalogus":
      "MOOR Platform is bekend binnen gemeentelijke sector; facturatie-ondersteuning sluit aan bij bestaande dienstverlening.",
    concurrent:
      "Geen concrete concurrent benoemd; MOOR F-O is uitbreiding op reeds afgenomen MOOR Platform.",
    "sla-dvo":
      "Ja, gebaseerd op bestaande hoofdovereenkomst met Roxit/MOOR (voorwaarden gelijk aan MOOR Platform-contract).",
    "koppeling-id":
      "Geen DigiD/eHerkenning/eIDAS-koppeling; betreft export naar financieel systeem met debiteurgegevens.",
    "fb-behoefte":
      "Ja, intern",
    "fb-taken":
      "Functioneel beheer bewaakt de periodieke exports, monitort debiteurinstellingen en stemt wijzigingen af met MOOR.",
    "fb-type": "Hybride",
    "itb-capaciteit":
      "IT-basisdiensten leveren ondersteuning voor aansluiting op het financiële systeem en beheer van importtaken.",
    bio2:
      "Geen specifieke BIO2-eisen benoemd; koppeling betrekt alleen financiële data vanuit MOOR.",
    nis2:
      "Niet expliciet beoordeeld; dienst valt onder reguliere beschikbaarheids- en integriteitseisen van bestaande MOOR Platform.",
    dataclassificatie:
      "Operationele gegevens over graafmeldingen en factuurlijnen; geen bijzondere persoonsgegevens.",
    "bio2-conform": "N.t.b.",
    iso27001: "N.t.b.",
    logging:
      "Periodieke exportlogboeken binnen MOOR; verdere logging in financieel systeem.",
    backup:
      "Back-up geregeld via MOOR Platform en gemeentelijke financiële systemen.",
    persoonsgegevens: "Gewone persoonsgegevens",
    "persoonsgegevens-detail":
      "Contact- en debiteurgegevens van netbeheerders/bedrijven die graafmeldingen doen.",
    "categorieen-betrokkenen":
      "Netbeheerders, aannemers en overige organisaties die graafwerkzaamheden uitvoeren.",
    "avg-grondslag":
      "Uitvoering van publiekrechtelijke taak (verwerken straatwerkkosten, leges en instemmingsbesluiten).",
    doeleinden:
      "Opstellen en verzenden van facturen voor straatwerk- en legeskosten op basis van MOOR-registraties.",
    verwerkersovereenkomst:
      "Onderdeel van bestaande hoofdovereenkomst MOOR Platform tussen Gemeente Wassenaar en Roxit.",
    doorgifte:
      "Geen doorgifte buiten de EU/EER genoemd.",
    "ai-algoritmen":
      "Geen gebruik van AI of geautomatiseerde besluitvorming benoemd.",
    dpia:
      "Niet uitgevoerd; inschatting laag risico omdat het om bedrijfsgegevens van bedrijven / debiteuren gaat.",
    zaaksysteem:
      "Geen zaaksysteemkoppeling; output wordt ingelezen in financieel systeem.",
    "document-management":
      "Exportbestand wordt bewaard conform financiële procedures; betalingen verlopen via financieel systeem.",
    basisregistraties:
      "Niet gekoppeld aan basisregistraties; gegevens komen vanuit MOOR en gemeentelijke administratie.",
    koppelingen:
      "Koppeling tussen MOOR Platform en financieel systeem via periodiek exportbestand.",
    gegevensuitwisseling:
      "Bestanden met factuurregels worden gedeeld tussen MOOR en Financiën, daarna verder verwerkt in financieel systeem.",
    "koppelingen-basis":
      "Niet van toepassing; geen automatische koppelingen met BAG/BRP etc.",
    waardeketen:
      "Ondersteunt waardeketen ‘Betrouwbare dienstverlening’ en ‘Efficiënte bedrijfsvoering’ voor beheer en facturatie.",
    "common-ground": "Nee",
    apis:
      "Export via bestand (CSV/XML) volgens gemeentelijk formaat; geen API benoemd.",
    bewaartermijn: "7 jaar",
    documentopslag:
      "Bewaren binnen financieel systeem en gemeentelijke administratie conform selectielijsten.",
    vernietiging:
      "Volgt reguliere financiële vernietigings- en archiveringsprocedures (na wettelijke bewaartermijn).",
    metadata:
      "Metadata volgt financieel systeem (factuurdatum, debiteur, kostenpost) en MOOR registraties."
  };
  const storageKey = "impact_intake_form_v20241123";
  const fields = document.querySelectorAll("[data-field]");
  const toast = document.getElementById("toast");
  const fileInput = document.getElementById("json-import");
  const metaNav = document.querySelector(".meta-toolbar");
  const themeToggle = metaNav?.querySelector("[data-action='toggle-theme']");
  const tabButtons = document.querySelectorAll(".tab-button");
  const tabPanels = document.querySelectorAll(".tab-panel");
  const themeKey = "impact_intake_theme";
  let saveTimer = null;

  function showToast(message) {
    toast.textContent = message;
    toast.classList.add("show");
    setTimeout(() => toast.classList.remove("show"), 2500);
  }

  function getFieldValue(field) {
    if (field.tagName === "SELECT") {
      return field.value;
    }
    return field.value || "";
  }

  function getFieldLabel(field) {
    return field.dataset.label || field.name || "Onbekend veld";
  }

  function hasFieldValue(field) {
    const value = getFieldValue(field);
    if (typeof value === "string") {
      return value.trim().length > 0;
    }
    return Boolean(value);
  }

  function getFieldWrapper(field) {
    return field.closest(".field, .status-card");
  }

  function updateFieldState(field) {
    if (!field) return;
    const wrapper = getFieldWrapper(field);
    if (!wrapper) return;
    wrapper.dataset.state = hasFieldValue(field) ? "filled" : "empty";
  }

  function refreshFieldStates() {
    fields.forEach(updateFieldState);
  }

  function collectData() {
    const data = {};
    fields.forEach((field) => {
      data[field.dataset.field] = getFieldValue(field);
    });
    return data;
  }

  function updateHeaderTitle() {
    const procesField = document.querySelector('[data-field="procesnaam"]');
    const processTitle = document.querySelector(".process-title");
    if (procesField && processTitle) {
      processTitle.textContent = procesField.value.trim() || "Nog geen procesnaam ingevuld";
    }
  }

  function applyData(data) {
    if (!data) return;
    
    // Migration for old contribution field
    if (data.contribution && !data["contribution-1"]) {
      const parts = data.contribution.split("|").map(p => p.trim()).filter(Boolean);
      if (parts.length > 0) data["contribution-1"] = parts[0];
      if (parts.length > 1) data["contribution-2"] = parts[1];
      if (parts.length > 2) data["contribution-3"] = parts[2];
    }

    fields.forEach((field) => {
      const key = field.dataset.field;
      if (Object.prototype.hasOwnProperty.call(data, key)) {
        field.value = data[key];
      }
    });
    refreshFieldStates();
    updateHeaderTitle();
  }

  function setTheme(theme) {
    const nextTheme = theme === "dark" ? "dark" : "light";
    document.documentElement.dataset.theme = nextTheme;
    if (themeToggle) {
      themeToggle.textContent = nextTheme === "light" ? "🌙 Donker thema" : "☀️ Licht thema";
      themeToggle.setAttribute("aria-pressed", nextTheme === "dark");
    }
  }

  function triggerAutoSave() {
    clearTimeout(saveTimer);
    saveTimer = setTimeout(saveToLocalStorage, 500);
  }

  function saveToLocalStorage() {
    const data = collectData();
    localStorage.setItem(storageKey, JSON.stringify(data));
    showToast("Intake opgeslagen (lokaal)");
  }

  function loadInitialData() {
    const raw = localStorage.getItem(storageKey);
    if (raw) {
      applyData(JSON.parse(raw));
    }
  }

  function resetForm() {
    if (!confirm("Weet je zeker dat je alle velden wilt leegmaken?")) {
      return;
    }
    document.getElementById("intake-form").reset();
    localStorage.removeItem(storageKey);
    refreshFieldStates();
    updateHeaderTitle();
    showToast("Formulier geleegd");
  }

  function handleSaveClick() {
    const data = collectData();
    const blob = new Blob([JSON.stringify(data, null, 2)], { type: "application/json" });
    const url = URL.createObjectURL(blob);
    const link = document.createElement("a");
    link.href = url;
    link.download = `impactanalyse-id-${new Date().toISOString().slice(0, 10)}.json`;
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
    URL.revokeObjectURL(url);
    showToast("JSON-export gedownload");
  }

  function handleLoadClick() {
    fileInput.value = "";
    fileInput.click();
  }

  function handlePrefillClick() {
    applyData(pdfPrefill);
    localStorage.setItem(storageKey, JSON.stringify(pdfPrefill));
    showToast("Velden gevuld met data uit de PDF");
  }

  function handleThemeToggle() {
    const currentTheme = document.documentElement.dataset.theme === "dark" ? "dark" : "light";
    const nextTheme = currentTheme === "dark" ? "light" : "dark";
    setTheme(nextTheme);
    localStorage.setItem(themeKey, nextTheme);
  }

  setTheme(localStorage.getItem(themeKey) || "light");

  fileInput.addEventListener("change", (event) => {
    const file = event.target.files?.[0];
    if (!file) return;
    const reader = new FileReader();
    reader.onload = (e) => {
      try {
        const data = JSON.parse(e.target.result);
        applyData(data);
        saveToLocalStorage();
        showToast("Intake geladen");
      } catch (error) {
        alert("Kon het bestand niet lezen: " + error.message);
      }
    };
    reader.readAsText(file);
  });

  function handlePdfClick() {
    const content = buildReportHtml(true, true);
    const container = document.getElementById("print-export");
    container.innerHTML = content;
    window.print();
  }

  function buildReportHtml(bodyOnly = false, onlyFilled = false) {
    const sections = document.querySelectorAll("[data-section]");
    const css = document.querySelector("style").textContent;
    const logoSrc = document.querySelector(".header-logo")?.src || "";
    const logoHtml = logoSrc ? `<img src="${logoSrc}" style="max-width: 180px; height: auto;" alt="Logo">` : "";
    
    const sectionHtml = Array.from(sections)
      .map((section) => {
        const title = section.getAttribute("data-section");
        const rows = Array.from(section.querySelectorAll("[data-field]"))
          .map((field) => {
            const label = getFieldLabel(field);
            let value = field.value || "";
            if (field.tagName === "SELECT") {
              const selected = field.options[field.selectedIndex];
              value = selected ? selected.text : "";
            }
            
            if (onlyFilled && (!value || !value.trim() || value === "Selecteer" || value === "Kies status")) {
              return "";
            }

            value = value.replace(/\n/g, "<br>");
            return `<tr><td>${label}</td><td>${value || "&nbsp;"}</td></tr>`;
          })
          .join("");
        
        if (onlyFilled && !rows.trim()) return "";

        return `<div class="card"><h2>${title}</h2><table>${rows}</table></div>`;
      })
      .join("");

    if (bodyOnly) {
      return `
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px; border-bottom: 2px solid #eee; padding-bottom: 16px;">
          <h1 style="margin: 0; font-size: 20pt; border: none;">Impactanalyse I&amp;D</h1>
          ${logoHtml}
        </div>
        ${sectionHtml}`;
    }

    return `<!DOCTYPE html><html><head><meta charset="utf-8"><title>Impactanalyse I&amp;D</title><style>
      ${css}
      body { padding: 40px; background: #f9f9f9; max-width: 1000px; margin: 0 auto; }
      .card { margin-bottom: 32px; break-inside: avoid; background: #fff; padding: 32px; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.05); border-top: 4px solid var(--support); }
      h1 { font-size: 24px; margin-bottom: 32px; color: var(--text); text-transform: uppercase; letter-spacing: 0.05em; }
      h2 { color: var(--text); border-bottom: none; margin-top: 0; }
      table { width: 100%; border-collapse: collapse; margin-top: 16px; }
      td { border-bottom: 1px solid var(--border); padding: 12px 8px; vertical-align: top; font-size: 0.95rem; line-height: 1.6; }
      td:first-child { font-weight: 600; width: 35%; color: var(--muted); }
      td:last-child { color: var(--text); }
      tr:last-child td { border-bottom: none; }
    </style></head><body>
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 32px;">
      <h1>Impactanalyse I&amp;D – Intakeformulier</h1>
      ${logoHtml}
    </div>
    ${sectionHtml}
    </body></html>`;
  }

  function handleHtmlClick() {
    const html = buildReportHtml();
    const blob = new Blob([html], { type: "text/html" });
    const url = URL.createObjectURL(blob);
    const link = document.createElement("a");
    link.href = url;
    link.download = `impactanalyse-id-${new Date().toISOString().slice(0, 10)}.html`;
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
    URL.revokeObjectURL(url);
    showToast("HTML-export aangemaakt");
  }

  function handleWordClick() {
    const html = buildReportHtml();
    const blob = new Blob(["\ufeff", html], { type: "application/msword" });
    const url = URL.createObjectURL(blob);
    const link = document.createElement("a");
    link.href = url;
    link.download = `impactanalyse-id-${new Date().toISOString().slice(0, 10)}.doc`;
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
    URL.revokeObjectURL(url);
    showToast("Word-document aangemaakt");
  }

  const wizardOverlay = document.getElementById("wizard-overlay");
  const wizardStage = document.getElementById("wizard-stage");
  const wizardBar = document.getElementById("wizard-bar");
  const wizardProgressText = document.getElementById("wizard-progress-text");
  const wizardSectionTitle = document.getElementById("wizard-section-title");
  const wizardClose = document.getElementById("wizard-close");
  let currentWizardStep = 0;
  let wizardFields = [];

  function startWizard() {
    wizardFields = Array.from(document.querySelectorAll(".field, .status-card")).filter(el => {
        return el.querySelector("input:not([type='hidden']), select, textarea");
    });
    if (wizardFields.length === 0) return;
    currentWizardStep = 0;
    wizardOverlay.classList.add("active");
    updateWizard();
  }

  function getFieldHelperText(element) {
    const input = element.querySelector("input, select, textarea");
    if (input && input.placeholder && input.placeholder.length > 5) return input.placeholder;
    if (input && input.title) return input.title;
    return "Vul dit veld in om de impactanalyse compleet te maken.";
  }

  function getSectionTitle(element) {
    const section = element.closest("section");
    return section ? section.dataset.section : "Algemeen";
  }

  function createWizardCard(index) {
    if (index < 0 || index >= wizardFields.length) return null;
    
    const sourceWrapper = wizardFields[index];
    const labelText = sourceWrapper.querySelector("label, span")?.textContent || "Vraag";
    const inputOriginal = sourceWrapper.querySelector("input, select, textarea");
    const helperText = getFieldHelperText(sourceWrapper);
    
    const card = document.createElement("div");
    card.className = "wizard-card";
    
    // Determine position class
    if (index === currentWizardStep) card.classList.add("active");
    else if (index === currentWizardStep - 1) card.classList.add("prev");
    else if (index === currentWizardStep + 1) card.classList.add("next");
    
    // Clone input
    const clone = inputOriginal.cloneNode(true);
    const realInput = inputOriginal;
    
    card.innerHTML = `
      <h3>${labelText}</h3>
      <div class="wizard-helper">${helperText}</div>
      <div class="field-container"></div>
      <div class="wizard-nav">
        <button class="wizard-btn prev" ${index === 0 ? 'disabled' : ''}>← Vorige</button>
        <button class="wizard-btn next">${index === wizardFields.length - 1 ? 'Klaar' : 'Volgende →'}</button>
      </div>
    `;
    
    const container = card.querySelector(".field-container");
    container.appendChild(clone);
    
    // Sync logic
    const wizardInput = container.querySelector("input, select, textarea");
    if (wizardInput) {
        wizardInput.value = realInput.value;
        wizardInput.addEventListener("input", (e) => {
            realInput.value = e.target.value;
            realInput.dispatchEvent(new Event('input'));
            realInput.dispatchEvent(new Event('change'));
        });
    }

    // Events
    card.querySelector(".prev").addEventListener("click", () => {
        if (currentWizardStep > 0) {
            currentWizardStep--;
            updateWizard();
        }
    });
    card.querySelector(".next").addEventListener("click", () => {
        if (currentWizardStep < wizardFields.length - 1) {
            currentWizardStep++;
            updateWizard();
        } else {
            wizardOverlay.classList.remove("active");
        }
    });

    return card;
  }

  function updateWizard() {
    wizardStage.innerHTML = "";
    
    // Render Previous, Current, Next cards for animation context
    [-1, 0, 1].forEach(offset => {
        const card = createWizardCard(currentWizardStep + offset);
        if (card) wizardStage.appendChild(card);
    });
    
    // Update Header Info
    const currentField = wizardFields[currentWizardStep];
    wizardSectionTitle.textContent = getSectionTitle(currentField);
    
    const progress = ((currentWizardStep + 1) / wizardFields.length) * 100;
    wizardBar.style.width = `${progress}%`;
    wizardProgressText.textContent = `Vraag ${currentWizardStep + 1} van ${wizardFields.length}`;
  }

  wizardClose.addEventListener("click", () => {
    wizardOverlay.classList.remove("active");
  });

  document.querySelector(".meta-toolbar")?.addEventListener("click", (event) => {
    const targetButton = event.target.closest("button");
    if (!targetButton) return;
    switch (targetButton.dataset.action) {
      case "wizard":
        startWizard();
        break;
      case "new":
        resetForm();
        break;
      case "load":
        handleLoadClick();
        break;
      case "prefill":
        handlePrefillClick();
        break;
      case "save":
        handleSaveClick();
        break;
      case "html":
        handleHtmlClick();
        break;
      case "pdf":
        handlePdfClick();
        break;
      case "word":
        handleWordClick();
        break;
      default:
        break;
    }
  });

  tabButtons.forEach((button) => {
    button.addEventListener("click", () => {
      const targetId = button.dataset.tabTarget;
      tabButtons.forEach((btn) => btn.classList.toggle("active", btn === button));
      tabPanels.forEach((panel) => panel.classList.toggle("active", panel.id === targetId));
    });
  });

  fields.forEach((field) => {
    const handleFieldInteraction = () => {
      updateFieldState(field);
      triggerAutoSave();
      if (field.dataset.field === "procesnaam") {
        updateHeaderTitle();
      }
    };
    field.addEventListener("input", handleFieldInteraction);
    field.addEventListener("change", handleFieldInteraction);
  });

  refreshFieldStates();
  loadInitialData();

  document.getElementById("intake-form").addEventListener("submit", (event) => {
    event.preventDefault();
  });
})();
</script>
</body>
</html>

